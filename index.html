<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/themes/light.css"
    />
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/shoelace.js"
    ></script>
    <link rel="stylesheet" href="checkin.css" />
    <script type="module" src="js/checkin-login.js"></script>
    <script type="module" src="js/checkin-main.js"></script>
    <script type="module" src="js/checkin-save.js"></script>
    <script type="module" src="js/checkin-inbox.js"></script>
  </head>
  <body>
    <div id="main"></div>
    <script type="module">
      const client_id = 'https://checkin.swf.pub/client.jsonld'
      const redirect_uri = 'https://checkin.swf.pub/'

      const routes = {
        login: () => `<checkin-login client-id=${client_id} redirect-uri=${redirect_uri} />`,
        inbox: () => `<checkin-inbox client-id=${client_id} redirect-uri=${redirect_uri} />`,
        save: () => `<checkin-save client-id=${client_id} redirect-uri=${redirect_uri} />`,
      };

      function navigate(route) {
        document.getElementById("main").innerHTML = routes[route] ? routes[route]() : `<h1>404 - Page Not Found</h1>`;
      }

      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        if (params.get("state")) {
          navigate("save");
        } else if (sessionStorage.getItem("access_token")) {
          navigate("inbox");
        } else {
          navigate("login");
        }
      });

      window.addEventListener("popstate", () => {
        const route = window.location.hash.replace("#", "") || "login";
        navigate(route);
      });
    </script>
  </body>
</html>
